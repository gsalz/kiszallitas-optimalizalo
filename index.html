<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Kisz√°ll√≠t√°s Optimaliz√°l√≥</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5E59duGPNKibjfN7snj7yCQDfa4iDPRQ&libraries=places"></script>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    input { width: 100%; }
    button { margin-top: 10px; }
  </style>
</head>
<body>

  <h1>Kisz√°ll√≠t√°s optimaliz√°l√°s</h1>

  <table id="ordersTable">
    <thead>
      <tr>
        <th>C√≠m</th>
        <th>Raklap</th>
        <th>S√∫ly (kg)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" value="Klingler Klaus 21, Tarnazsad√°ny"></td>
        <td><input type="number" value="1"></td>
        <td><input type="number" value="200"></td>
      </tr>
    </tbody>
  </table>

  <button onclick="addRow()">‚ûï √öj c√≠m hozz√°ad√°sa</button>
  <button onclick="optimize()">üß† Optimaliz√°l√°s ind√≠t√°sa</button>

  <div id="result"></div>

  <script>
    const depots = [
      { name: "Budapest", address: "1173 Budapest, R√©giv√°m k√∂z 6." },
      { name: "Gy≈ër", address: "9027 Gy≈ër, Csonka J√°nos u. 3." },
      { name: "Miskolc", address: "3527 Miskolc, V√°rk√∂zi Lajos utca 5." },
      { name: "Szeged", address: "6728 Szeged, Back Bern√°t u. 2." }
    ];

    const regionalZones = {
      "Gy≈ër": ["Gy≈ër", "Mosonmagyar√≥v√°r", "Kom√°rom", "Csorna"],
      "Miskolc": ["Miskolc", "Eger", "Kazincbarcika", "Tisza√∫jv√°ros"],
      "Szeged": ["Szeged", "Mak√≥", "H√≥dmez≈ëv√°s√°rhely", "Kistelek"]
    };

    function addRow() {
      const table = document.querySelector("#ordersTable tbody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text"></td>
        <td><input type="number" value="1"></td>
        <td><input type="number" value="0"></td>
      `;
      table.appendChild(row);
    }

    async function getBestDepot(destination) {
      const service = new google.maps.DistanceMatrixService();
      return new Promise((resolve) => {
        service.getDistanceMatrix({
          origins: depots.map(d => d.address),
          destinations: [destination],
          travelMode: 'DRIVING',
          unitSystem: google.maps.UnitSystem.METRIC
        }, (response, status) => {
          if (status !== 'OK') {
            console.error('Hiba a Google Maps lek√©rdez√©sben:', status);
            resolve({ name: "Ismeretlen", distance: null });
          } else {
            const results = response.rows.map((row, i) => ({
              name: depots[i].name,
              distance: row.elements[0].distance.value,
              duration: row.elements[0].duration.value
            }));

            const lowerDest = destination.toLowerCase();

            // 1Ô∏è‚É£ Ha egy vid√©ki telephely 60 km-en bel√ºl van ‚Üí ≈ë sz√°ll√≠t
            const nearDepot = results.find(r =>
              r.name !== "Budapest" && r.distance <= 60000
            );
            if (nearDepot) {
              resolve(nearDepot);
              return;
            }

            // 2Ô∏è‚É£ Ha a c√≠m szerepel a vid√©ki r√©gi√≥kban ‚Üí az sz√°ll√≠t
            for (let depotName in regionalZones) {
              if (regionalZones[depotName].some(city => lowerDest.includes(city.toLowerCase()))) {
                const match = results.find(r => r.name === depotName);
                resolve(match);
                return;
              }
            }

            // 3Ô∏è‚É£ Egy√©bk√©nt Budapest sz√°ll√≠t
            const budapest = results.find(r => r.name === "Budapest");
            resolve(budapest);
          }
        });
      });
    }

    async function optimize() {
      const rows = document.querySelectorAll("#ordersTable tbody tr");
      const resultList = document.getElementById("result");
      resultList.innerHTML = "<h3>Eredm√©nyek:</h3><ul>";

      for (const row of rows) {
        const cells = row.querySelectorAll("input");
        const address = cells[0].value;
        const raklap = parseFloat(cells[1].value);
        const kg = parseFloat(cells[2].value);

        const depotInfo = await getBestDepot(address);
        resultList.innerHTML += `<li>üìç ${address} ‚Äì ${raklap} raklap, ${kg} kg ‚Üí üöö <strong>${depotInfo.name}</strong> (${Math.round(depotInfo.distance / 1000)} km)</li>`;
      }

      resultList.innerHTML += "</ul>";
    }
  </script>
</body>
</html>
